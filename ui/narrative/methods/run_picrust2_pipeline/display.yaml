#
# define display information
#
name: PICRUSt2 Pipeline v2.3.0_b

tooltip: |
    Predict prokaryote EC, KO, and MetaCyc abundance from 16S amplicon matrix

screenshots: []

icon: icon.png

#
# define a set of similar apps that might be useful to the user
#
suggestions:
    apps:
        related:
            [kb_faprotax.run_FAPROTAX, app2]
        next:
            [GenericsAPI.transform_matrix, app4]

#
# Configure the display and description of parameters
#
parameters :
    amplicon_matrix_upa :
        ui-name : |
            AmpliconMatrix
        short-hint : |
            Input object of type <code>AmpliconMatrix</code>
    create_amplicon_fps:
        ui-name: |
            Create amplicon FunctionalProfiles
        short-hint: |
            Create amplicon FunctionalProfiles
    create_sample_fps:
        ui-name: |
            Create sample FunctionalProfiles
        short-hint: |
            Create sample FunctionalProfiles
    output_name:
        ui-name: |
            Updated AmpliconMatrix name
        short-hint: |
            (Optional) If input AmpliconMatrix has a row AttributeMapping, both will be updated. Default output AmpliconMatrix name is same name, which will save over input object

parameter-groups:
    fp_options:
        ui-name: |
            FunctionalProfile options
        short-hint: |
            FunctionalProfile options. Uncheck these to avoid creation of up to 6 <code>FunctionalProfile</code> objects

description : |

    <p>
    Predicts EC, KO, and MetaCyc abundance per 16S gene or per sample, 
    provided a 16S abundance table.
    </p>

    <!--------------------------------------------------------------------------------------------->
    <h3>App Behavior</h3>

    <p>
    If input <code>AmpliconMatrix</code> has a row <code>AttributeMapping</code>, 
    this app generates a new row <code>AttributeMapping</code> updated with MetaCyc functions
    and an <code>AmpliconMatrix</code> with an updated row <code>AttributeMapping</code> reference.
    </p>

    <p>
    PICRUSt2 may drop amplicons, accounting for dissimilarity to its reference genomes, at two steps.
    (1) When aligning the 16S sequences to the reference sequences before building a tree,
    and thus before any tables are output, amplicons can be dropped for poor alignment.
    (2) Before calculating the community functional abundance matrices, any sequence that is
    above a distance criterion from the reference sequences in the tree is dropped.
    </p>

    <p>
    Can generate three new community <code>FunctionalProfile</code>s and three new organism <code>FunctionalProfile</code>s;
    three because one for each of PICRUSt2's predicted EC, KO, and MetaCyc functions. 
    </p>

    <p>
    For the heatmaps, <code>EC_metagenome_out/pred_metagenome_unstrat.tsv</code> and 
    <code>KO_metagenome_out/pred_metagenome_unstrat.tsv</code> are renamed to <code>EC_pred_metagenome_unstrat.tsv</code> and
    <code>KO_pred_metagenome_unstrat.tsv</code>, respectively
    The heatmaps can be very large and sparse, which can make them uninformative and difficult to display.
    A somewhat arbitrary filtering technique is adopted: 
    the 2800 rows or columns with the largest sums (or L1 norms in this case) are retained. 
    2800 because 8M data points is a technical restraint.
    </p>

    <!--------------------------------------------------------------------------------------------->
    <h3>Resources</h3>

    <a href="https://github.com/picrust/picrust2/wiki">PICRUSt2 Wiki</a>

    <!--------------------------------------------------------------------------------------------->
    <h3>Aknowledgements</h3>

    <p>
    Thanks to P. Weisenhorn for helpful comments and UI/behavior suggestions.
    </p>

    <br><br>

publications: # Is it weird/shady that I got most citations from the PICRUSt2 paper?

    -
        # PICRUSt2
        display-text: |
            Douglas, G.M., Maffei, V.J., Zaneveld, J.R. et al. PICRUSt2 for prediction of metagenome functions. Nat Biotechnol 38, 685–688 (2020), https://doi.org/10.1038/s41587-020-0548-6 
        link: |
            https://doi.org/10.1038/s41587-020-0548-6

    -
        # HMMER
        display-text: |
            HMMER
        link: |
            http://www.hmmer.org/

    -
        # EPA-ng
        display-text: |
            Pierre Barbera, Alexey M Kozlov, Lucas Czech, Benoit Morel, Diego Darriba, Tomáš Flouri, Alexandros Stamatakis, EPA-ng: Massively Parallel Evolutionary Placement of Genetic Sequences, Systematic Biology, Volume 68, Issue 2, March 2019, Pages 365–369, https://doi.org/10.1093/sysbio/syy054
        link: |
            https://doi.org/10.1093/sysbio/syy054

    -
        # GAPPA
        display-text: |
            Lucas Czech, Pierre Barbera, Alexandros Stamatakis, Genesis and Gappa: processing, analyzing and visualizing phylogenetic (placement) data, Bioinformatics, https://doi.org/10.1093/bioinformatics/btaa070
        link: | 
            https://doi.org/10.1093/bioinformatics/btaa070

    - 
        # castor
        display-text: |
            Stilianos Louca, Michael Doebeli, Efficient comparative phylogenetics on large trees, Bioinformatics, Volume 34, Issue 6, 15 March 2018, Pages 1053–1055, https://doi.org/10.1093/bioinformatics/btx701
        link: |
            https://doi.org/10.1093/bioinformatics/btx701


    -
        # IMG
        display-text: |
            Victor M. Markowitz, I-Min A. Chen, Krishna Palaniappan, Ken Chu, Ernest Szeto, Yuri Grechkin, Anna Ratner, Biju Jacob, Jinghua Huang, Peter Williams, Marcel Huntemann, Iain Anderson, Konstantinos Mavromatis, Natalia N. Ivanova, Nikos C. Kyrpides, IMG: the integrated microbial genomes database and comparative analysis system, Nucleic Acids Research, Volume 40, Issue D1, 1 January 2012, Pages D115–D122, https://doi.org/10.1093/nar/gkr1044
        link: |
            https://doi.org/10.1093/nar/gkr1044


    -
        # MinPath
        display-text: |
            MinPath
    -
        # KO
        display-text: |
            Minoru Kanehisa, Susumu Goto, Yoko Sato, Miho Furumichi, Mao Tanabe, KEGG for integration and interpretation of large-scale molecular data sets, Nucleic Acids Research, Volume 40, Issue D1, 1 January 2012, Pages D109–D114, https://doi.org/10.1093/nar/gkr988
        link: |
            https://doi.org/10.1093/nar/gkr988

    -
        # EC
        display-text: |
            Enzyme Commission (EC)

    -
        # MetaCyc
        display-text: |
            Ron Caspi, Richard Billington, Luciana Ferrer, Hartmut Foerster, Carol A. Fulcher, Ingrid M. Keseler, Anamika Kothari, Markus Krummenacker, Mario Latendresse, Lukas A. Mueller, Quang Ong, Suzanne Paley, Pallavi Subhraveti, Daniel S. Weaver, Peter D. Karp, The MetaCyc database of metabolic pathways and enzymes and the BioCyc collection of pathway/genome databases, Nucleic Acids Research, Volume 44, Issue D1, 4 January 2016, Pages D471–D480, https://doi.org/10.1093/nar/gkv1164
        link: |
            https://doi.org/10.1093/nar/gkv1164

    -
        # plotly
        display-text: |
            Plotly Technologies Inc. Collaborative data science. Montréal, QC, 2015. https://plot.ly.





